/**
 * webpackÂü∫Á°ÄÈÖçÁΩÆ
 *
 * @author josnleex <jsonleex@163.com> (17-09-23 05:11)
 * 
 */

import webpack from "webpack";

/**
 * ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑ÔºåÁî®‰∫éËé∑ÂèñÂëΩ‰ª§Ë°åÂèÇÊï∞
 */
import yargs from 'yargs';

/**
 * ÊèêÂèñÂëΩ‰ª§Ë°åÂèÇÊï∞ÈÖçÁΩÆ
 * 
 * - p      -> ÁéØÂ¢ÉÈÖçÁΩÆ ÊòØÂê¶‰ºòÂåñÂíåÂéãÁº©‰ª£Á†Å
 * 
 */
export const options = yargs
    .alias('p', 'optimize-minimize')
    .alias('d', 'debug')
    .argv;

const baseConfig = {
    /**
     * ÂÖ•Âè£ÈÖçÁΩÆ
     * @type { string | object | array }
     *
     * entry: "./app/entry",
     * 
     * entry: ["./app/entry1", "./app/entry2"],
     *
     * entry: {
     *     a: "./app/entry-a",
     *     b: ["./app/entry-b1", "./app/entry-b2"]
     * },
     * 
     */
    entry: undefined,

    /**
     * ËæìÂá∫ÈÖçÁΩÆ (path filename publicPath)
     *
     *  path        -> ‰øùÂ≠òË∑ØÂæÑ
     *
     *  filename    -> Êñá‰ª∂Âêç
     *
     *  publicPath  -> ËæìÂá∫ÁõÆÂΩïÁõ∏ÂØπ‰∫éHTMLÈ°µÈù¢ÁöÑurl (ÂàÜÂ∏ÉÂºè CDN ÊÉÖÂÜµ‰∏ãÈùûÂ∏∏ÂÆûÁî®)
     *  
     */
    output: undefined,

    /**
     * [externals description]
     * @type {[type]}
     */
    externals: undefined,

    /**
     * Ê®°ÂùóÈÖçÁΩÆ
     * 
     */
    module: {
        /**
         * Âä†ËΩΩÂô® ÊåáÂÆö xx Êñá‰ª∂Áî± xx-loader Ëß£Êûê
         * 
         * @type {Array}
         *
         * Âü∫Êú¨Ê†ºÂºèÔºö{ 
         *     test: REG,                   // Ëß£ÊûêÊñá‰ª∂Á±ªÂûã
         *     includeÔºö/src/,              // Ëß£ÊûêÊåáÂÆöÁõÆÂΩï
         *     exclude: /node_modules/,     // ‰∏çÁî®Ëß£ÊûêÁöÑÊñá‰ª∂ÁõÆÂΩï
         *     loader: xx-loader,           // ÊåáÂÆöÂä†ËΩΩÂô®
         *     option: {},                  // xx-loader ÁöÑÂÖ∂‰ªñÈÖçÁΩÆÈ°π
         * }
         */
        loaders: [
            { test: /\.js/, loader: "babel-loader", exclude: /node_modules/ }
        ]
    },

    /**
     * ‰∏∫ÊµèËßàÂô®devtoolsÊ∑ªÂä†ÂÖÉ‰ø°ÊÅØÊù•Â¢ûÂº∫Ë∞ÉËØï
     * @type {String}
     *
     * ‰ΩøÁî® source-map ‰ºöÈôç‰ΩéÊûÑÂª∫ÈÄüÂ∫¶
     * 
     */
    // leex: Ê≠§Â§Ñ‰øÆÊîπ‰∏∫Ê†πÊçÆÁéØÂ¢ÉÂèòÈáèÈÖçÁΩÆ baseConfig.devtool
    // devtool: "source-map", 

    /**
     * Êèí‰ª∂
     * @type {Array}
     * 
     */
    plugins: [
        /**
         *
         * DefinePlugin (Áõ¥ËØëÔºöwebpackÁöÑÂÆö‰πâÊèí‰ª∂ --Ê≠§Â§ÑË¶ÅË¢´ÊÄº üòÇ)
         * 
         * ÂÆòÊñπÊñáÊ°£ -> https://webpack.js.org/plugins/define-plugin/
         *
         */
        new webpack.DefinePlugin({
            'process.env': {
                NODE_ENV: JSON.stringify(options.optimizeMinimize ? 'production' : 'development')
            }
        })
    ]
};

if(options.optimizeMinimize) {
    baseConfig.devtool = 'source-map';
}

export default baseConfig;